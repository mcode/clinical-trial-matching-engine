<custom-spinner
  class="topVisible"
  *ngIf="showOverlay"
  [value]="loadingPercentage"
  [mode]="loadingMode"
  [loadingText]="loadingText"
></custom-spinner>

<header>
  <div class="row">
    <div class="Graph-section" id="header">
      <h1 (click)="backToHomePage()">
        <svg xmlns="http://www.w3.org/2000/svg" width="33.5" height="40.926" viewBox="0 0 33.5 40.926">
          <path
            id="iconfinder_laboratory_microscope_research_science__5310256"
            d="M70.663,35.492a.682.682,0,0,1,0-.965L72.592,32.6a.682.682,0,0,1,.965,0l2.894,2.894a.682.682,0,0,1,0,.965l-1.929,1.929a.682.682,0,0,1-.965,0ZM92.849,20.058,90.438,22.47l1.447,1.447a.682.682,0,0,1,0,.965l-3.8,3.8a4.242,4.242,0,0,1,.341,4.376A14.279,14.279,0,0,1,79.33,49.923v1.547h6.821a3.414,3.414,0,0,1,3.411,3.411v1.364a.682.682,0,0,1-.682.682H60.231a.682.682,0,0,1-.682-.682V54.88a3.414,3.414,0,0,1,3.411-3.411h6.821V48.059a4.751,4.751,0,0,1,.278-1.6L61.113,37.51a.682.682,0,0,1,0-.965l1.929-1.929a.682.682,0,0,1,.965,0l8.945,8.945a4.766,4.766,0,0,1,4.995,1.14,8.9,8.9,0,0,0,5.425-9.52,4.2,4.2,0,0,1-1.191-.6l-1.833,1.833a.682.682,0,0,1-.965,0L72.63,29.665a.682.682,0,0,1,0-.965L84.167,17.164a.682.682,0,0,1,.965,0l1.447,1.447L88.991,16.2a.682.682,0,0,1,.965,0l2.894,2.894a.682.682,0,0,1,0,.965Zm-6.734,9.627a2.073,2.073,0,1,0,0,2.932,2.073,2.073,0,0,0,0-2.932ZM76.6,48.059A2.046,2.046,0,1,0,74.555,50.1,2.046,2.046,0,0,0,76.6,48.059Z"
            transform="translate(-59.549 -16)"
            fill="#f5f5f5"
          />
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" width="355" height="43" viewBox="0 0 355 43">
          <text
            id="Clinical_Trial_Finder"
            data-name="Clinical Trial Finder"
            transform="translate(0 34)"
            fill="#f5f5f5"
            font-size="32"
            font-family="Roboto-Black, Roboto"
            font-weight="800"
          >
            <tspan x="0" y="0">CLINICAL TRIAL FINDER</tspan>
          </text>
        </svg>
      </h1>
    </div>
  </div>
</header>
<div class="row">
  <!-- Home page-->
  <div *ngIf="!searchPage">
    <h1 class="color1 header">Welcome {{ (patient | async)?.getUsualName() }},</h1>
    <h1 class="color2 header2">Let’s find some clinical trials</h1>
    <h1 class="color1 subText">
      We found your <span class="view-record-text" (click)="showRecord()">record</span>. Just fill in some preferences
      and we’ll do the rest
    </h1>
    <app-search-fields [phases]="phaseDropDown" [recruitmentStatuses]="recDropDown" (searchClicked)="searchClinicalTrials($event)"></app-search-fields>
    <!--Patient Records-->
    <app-record-data
      [(displayOn)]="this.records"
      [bundleResources]="this.bundleResources"
      [patient]="this.patient"
      max-height="90vh"
      height="90%"
      vertical-align="top"
      position="absolute"
      overflow="scroll"
      overflow-y="scroll"
    >
    </app-record-data>
  </div>
  <!-- Cards page-->
  <div class="mi-margin-5" style="margin-top: 9%;" *ngIf="!searchtable">
    <div class="containingDIV padding-bottom-20">
      <div class="totalCount padding-top-10"></div>
      <span class="color4 matching">
        <span class="matching color3">{{ resultCount }}</span>
        Matching Trials</span
      >
      <div>
        <div
          *ngFor="let filter of filtersArray; let i = index"
          class="filters mi-margin-10"
          style="position: relative; display: inline-block;"
        >
          <span class="color1 filterText pointer"> {{ filter.val }} </span>
          <div class="dropdown-content">
            <div style="height: 230px; overflow-y: scroll;">
              <ul *ngFor="let filterdrop of filter.data; let j = index">
                <li (click)="checkBoxClick(i, j)" class="color11">
                  <input
                    type="checkbox"
                    class="checkboxClass"
                    [checked]="filterdrop.selectedItems"
                    [value]="filterdrop.selectedItems"
                  />{{ filterdrop.val }}
                </li>
              </ul>
            </div>
            <div>
              <div style="border-top: 0.5px solid #9d9d9d; margin-bottom: 10px;">
                <div class="float-right mi-margin-10">
                  <span (click)="clearFilter(i)" class="color11 pointer">CLEAR</span>
                  <button
                    (click)="applyFilter()"
                    class="mi-margin-left-10 color8"
                    style="background-color: #52e0f2; width: 89px;"
                  >
                    Apply
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div
          class="filters mi-margin-10"
          (click)="exportSavedTrials()"
          style="position: relative; display: inline-block;"
        >
          <span class="color1 filterText pointer">{{
            savedClinicalTrialsNctIds.size > 0 ? 'Export Saved Trials' : 'Export All Trials'
          }}</span>
        </div>
        <div>
          <form>
            <select
              class="filters mi-margin-10 color1 pointer"
              [(ngModel)]="sortType"
              (ngModelChange)="applyFilter()"
              [ngModelOptions]="{ standalone: true }"
            >
              <option value="likelihood">Match Likelihood</option>
              <option value="distance">Distance</option>
            </select>
          </form>
        </div>
      </div>
      <div class="padding-left-20 padding-top-15">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 37 37">
          <path
            id="ic_directions_24px"
            d="M38.466,19.193,21.812,2.539a1.843,1.843,0,0,0-2.609,0L2.549,19.193a1.843,1.843,0,0,0,0,2.609L19.2,38.456a1.843,1.843,0,0,0,2.609,0L38.466,21.8a1.843,1.843,0,0,0,0-2.609ZM24.2,25.133V20.507H16.8v5.551H13.1v-7.4a1.856,1.856,0,0,1,1.85-1.85H24.2V12.18l6.477,6.477Z"
            transform="translate(-2.007 -1.997)"
            fill="#525151"
          ></path>
        </svg>
        <span class="cardText2 font-size-20">{{ searchReqObject.zipCode }}</span>
      </div>
      <div class="padding-left-20 padding-top-15">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 37 37">
          <path
            id="ic_directions_24px"
            d="M38.466,19.193,21.812,2.539a1.843,1.843,0,0,0-2.609,0L2.549,19.193a1.843,1.843,0,0,0,0,2.609L19.2,38.456a1.843,1.843,0,0,0,2.609,0L38.466,21.8a1.843,1.843,0,0,0,0-2.609ZM24.2,25.133V20.507H16.8v5.551H13.1v-7.4a1.856,1.856,0,0,1,1.85-1.85H24.2V12.18l6.477,6.477Z"
            transform="translate(-2.007 -1.997)"
            fill="#525151"
          ></path>
        </svg>
        <span class="cardText2 font-size-20">{{ searchReqObject.travelRadius }} Miles</span>
      </div>
    </div>
    <span class="color11">{{
      resultCount == 0
        ? 'Showing 0 of 0'
        : 'Showing ' + (selectedPage.firstIndex + 1) + '-' + selectedPage.lastIndex + ' of ' + resultCount
    }}</span>
    <div style="padding-bottom: 20px; height: 60vh; overflow-y: scroll; margin-top: 10px;" class="mitTable">
      <div *ngFor="let trial of selectedPageTrials; let k = index">
        <div (click)="showDetails(k)">
          <!-- Card Component-->
          <app-trial-card
            class="row containingDIV cards pointer"
            [clinicalTrial]="trial"
            [reqs]="searchReqObject"
            [trialSaved]="savedClinicalTrialsNctIds.has(trial.nctId)"
            (trialSaveChanged)="setTrialSaved(trial, $event)"
          >
          </app-trial-card>
        </div>
      </div>
    </div>
    <div class="containingDIV float-right">
      <p class="mi-margin-10 color7">Items per page</p>
      <select class="pointer" (change)="updateItemsPerPage($event.target.value)">
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="30">30</option>
      </select>
      <span class="mi-margin-10 color7 pointer" (click)="showPage(0)">First </span>
      <span
        *ngFor="let page of getNearest()"
        class="mi-margin-10 color7 pointer"
        (click)="viewPage(page)"
        [ngClass]="selectedPage.index == page.index ? 'selectedPage' : ''"
        >{{ page.index + 1 }}</span
      >
      <span class="mi-margin-10 color7 pointer" (click)="showPage(pages.length - 1)">Last </span>
    </div>
  </div>
  <app-result-details
    *ngIf="!detailsPage"
    [clinicalTrial]="detailedTrial"
    [trialSaved]="savedClinicalTrialsNctIds.has(detailedTrial.nctId)"
    [reqs]="searchReqObject"
    (trialSaveChanged)="setTrialSaved(detailedTrial, $event)"
  >
    <div class="mi-margin-10 col100 containingDIV pointer" (click)="backToSearch()">
      <svg xmlns="http://www.w3.org/2000/svg" width="40.641" height="40.641" viewBox="0 0 40.641 40.641">
        <g id="arrow_upward-24px" transform="translate(0 40.641) rotate(-90)">
          <path id="Path_20" data-name="Path 20" d="M0,0H40.641V40.641H0Z" fill="none" />
          <path
            id="Path_21"
            data-name="Path 21"
            d="M4,17.547l2.388,2.388,9.466-9.449V31.094H19.24V10.486l9.449,9.466,2.4-2.4L17.547,4Z"
            transform="translate(2.773 2.773)"
            fill="#efefef"
          />
        </g></svg><span class="color8" style="margin-top: 10px;"> Back to results</span>
    </div>
  </app-result-details>
  <div class="row footer" *ngIf="!searchPage">
    <div class="col-sm-4"></div>
  </div>
</div>
